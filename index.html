<!DOCTYPE html>
<html lang="en" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Squares - Database editor</title>
    <link rel="stylesheet" href="assets/css/tailwind.min.css" />
    <link rel="icon" type="image/png" href="assets/favicon.png" />

    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body class="flex flex-col h-full text-gray-800 font-base">
    <!-- Topbar wrap -->
    <topbar-wrap></topbar-wrap>
    <!-- Sidebar main -->
    <div class="flex flex-1 overflow-hidden">
      <!-- Sidebar -->
      <sidebar-x></sidebar-x>
      <!-- Main -->
      <main-x class="flex flex-col flex-1 px-4 overflow-hidden bg-gray-50">
        <tab-items></tab-items>
        <select-table class="flex items-center justify-center flex-1 w-full gap-2 text-2xl bg-white border-l">
          <img-svg src="remixicon/arrow-left-s-line.svg" classes="w-7 h-7 opacity-25"></img-svg>
          Select a table...
        </select-table>
      </main>
    </div>

    <modal-box></modal-box>

    <script>
      function dump(myObject) {
        console.log(JSON.stringify(myObject, null, 4));
      }
      
      const $ = (selector, base = document) => {
        return base.querySelector(selector);
      };
      const $$ = (selector, base = document) => {
        return base.querySelectorAll(selector);
      };

      Node.prototype.on = function (type, listener) {
        return this.addEventListener(type, listener);
      };

      var store = {
        table: {
          activate: (database, table) => {
            state.database = database;
            state.table = table;

            $(`tab-items`).activate(database, table);
            //$(`sidebar-table[database="${database}"][table="${table}"]`).activate();
          },
          close(database, table) {
            $(`tab-items`).tab(database, table).remove();

            // Inte sÃ¥ snyggt
            $(`sidebar-table[active="true"]`).deactivate();

            state.database = null;
            state.table = null;
          }
        },
        tables: {
          load: () => {
            axios.get(`server/php/queries/tables.php?database=${state.database}`).then((response) => {
              if (response.status !== 200) return;

              var index = state.databases.findIndex(p => p.name == state.database);
              state.databases[index].tables = response.data;

              console.log(response.data);

              $(`sidebar-database[database="${state.database}"] sidebar-tables`).populate(response.data);
            });
            console.log('load_tables');
          }
        },
        database: {
          activate(database) {
            state.database = database;

            $(`sidebar-database[database="${database}"]`).activate();
            if($(`sidebar-database[database="${database}"] sidebar-tables`).isEmpty()) {
              store.tables.load();
            }
            //$(`sidebar-tables`, sidebar).deactivate();
          },
        },
      };

      var state = {
        database: null,
        table: null,
        databases_order: [],
        databases: {},
        tables: []
      };

      var in_field = false;
      var dom = {
        current: null,
        left: null,
        right: null,
        top: null,
        down: null,
      };
      var current = {
        database: null,
        table: null,
      };

      var data = {};
      var tables = {};
      var temp = {
        insert: {},
        update: {}
      };

      window.addEventListener("DOMContentLoaded", () => {
        eventCellKeydown();
        //outsideClick();
        //eventCellClick();
        //eventCellDoubleclick();

      });

      
    </script>

    <script src="assets/js/axios.min.js"></script>
    <script src="assets/js/script.js"></script>
  </body>
</html>
